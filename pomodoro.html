<!DOCTYPE html>
<html lang="id" class="overflow-x-hidden">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pomodoro Timer</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Google Fonts: Poppins -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --ungu: #5a39a7;
      --oren: #f35026;
      --oren-pastel: #fee5df;
      --ungu-pastel: #cfd5fc;
      --ungu-pastel2: #9a7edb ;
    }

    body {
      font-family: 'Poppins', sans-serif;
      scroll-behavior: smooth;
      background-color: #fefefe;
      color: #1f2937;
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      border-radius: 10px;
      background: transparent;
    }
    ::-webkit-scrollbar-thumb {
      background-color: var(--ungu);
      border-radius: 8px;
    }

    /* Active mode button */
    .btn-mode.active {
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }

    /* General input styling */
    input[type="number"],
    input[type="text"],
    textarea {
      font-family: 'Poppins', sans-serif;
      border: 1.5px solid #a8c0ff;
      background-color: #e8efff;
      border-radius: 8px;
      color: #333;
      padding: 0.5rem 0.75rem;
      transition: all 0.3s ease;
    }

    input:focus,
    textarea:focus {
      outline: none;
      border-color: var(--ungu);
      background-color: #d4dbff;
      box-shadow: 0 0 8px rgba(90, 125, 232, 0.35);
    }

    /* Button timer */

    .btn-pomodoro {
    background-color: var(--oren) !important;
    color: white !important;
    }
    .btn-short {
        background-color: var(--ungu) !important;
        color: white !important;
    }
    .btn-long {
        background-color: var(--ungu-pastel2) !important;
        color: white !important;
    }

  </style>
</head>

<body id="app-body" class="overflow-x-hidden">
    <!-- Suara Notifikasi -->
    <audio id="notification-sound" src="./public/assets/sounds/notif-sound.mp3" preload="auto" loop></audio>
    <audio id="background-music" src="./public/assets/music/Daniel Caesar, Rex Orange County - Rearrange My World (Audio) [ ezmp3.cc ].mp3" loop></audio>

    <!-- Alarm Modal -->
    <div id="alarm-modal" class="fixed inset-0 flex items-center justify-center pointer-events-none opacity-0 z-50 transition-all duration-300">
        <div aria-hidden="true" class="fixed inset-0 bg-black/50 backdrop-blur-sm opacity-0 transition-opacity duration-300"></div>
        <div class="transform bg-white text-[#5a39a7] p-6 rounded-2xl shadow-xl transition-all duration-300 opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95 max-w-sm w-full text-center">
            <p class="text-lg font-bold mb-4">Waktu selesai!</p>
            <button id="stop-alarm-btn" class="bg-[#f35026] hover:bg-[#d6411f] text-white px-4 py-2 rounded-lg transition-all">Stop Alarm</button>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" role="dialog" aria-modal="true" aria-labelledby="settings-title" class="fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm transition-opacity duration-300 pointer-events-none opacity-0">
        <div aria-hidden="true" class="fixed inset-0 bg-black/60 transition-opacity opacity-0 backdrop-blur-sm"></div>
        <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
            <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
                <div class="relative transform overflow-hidden rounded-2xl bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95">
                    <div class="px-6 pt-6 pb-4 sm:p-6 sm:pb-4">
                        <div class="sm:flex sm:items-start">
                            <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                                <h3 id="settings-title" class="text-lg font-semibold text-[var(--ungu)] mb-4">
                                    Pengaturan Pomodoro
                                </h3>
                                <div class="space-y-4">
                                    <!-- Input Group -->
                                    <div>
                                        <label for="pomodoro-input" class="block text-sm font-medium text-gray-700 mb-1">
                                            Waktu Pomodoro (menit)
                                        </label>
                                        <input type="number" id="pomodoro-input" min="1" max="60" value="25"
                                            class="w-full px-3 py-2 border border-[var(--ungu-pastel)] rounded-lg
                                            bg-[var(--ungu-pastel)] text-gray-800 placeholder-gray-500
                                            focus:outline-none focus:ring-2 focus:ring-[var(--ungu)] focus:border-transparent transition duration-300">
                                    </div>

                                    <div>
                                        <label for="short-break-input" class="block text-sm font-medium text-gray-700 mb-1">
                                            Istirahat Pendek (menit)
                                        </label>
                                        <input type="number" id="short-break-input" min="1" max="30" value="5"
                                            class="w-full px-3 py-2 border border-[var(--ungu-pastel)] rounded-lg
                                            bg-[var(--ungu-pastel)] text-gray-800 placeholder-gray-500
                                            focus:outline-none focus:ring-2 focus:ring-[var(--ungu)] focus:border-transparent transition duration-300">
                                    </div>

                                    <div>
                                        <label for="long-break-input" class="block text-sm font-medium text-gray-700 mb-1">
                                            Istirahat Panjang (menit)
                                        </label>
                                        <input type="number" id="long-break-input" min="1" max="60" value="15"
                                            class="w-full px-3 py-2 border border-[var(--ungu-pastel)] rounded-lg
                                            bg-[var(--ungu-pastel)] text-gray-800 placeholder-gray-500
                                            focus:outline-none focus:ring-2 focus:ring-[var(--ungu)] focus:border-transparent transition duration-300">
                                    </div>

                                    <div>
                                        <label for="cycles-input" class="block text-sm font-medium text-gray-700 mb-1">
                                            Siklus Sebelum Istirahat Panjang
                                        </label>
                                        <input type="number" id="cycles-input" min="1" max="10" value="4"
                                            class="w-full px-3 py-2 border border-[var(--ungu-pastel)] rounded-lg
                                            bg-[var(--ungu-pastel)] text-gray-800 placeholder-gray-500
                                            focus:outline-none focus:ring-2 focus:ring-[var(--ungu)] focus:border-transparent transition duration-300">
                                    </div>

                                    <div>
                                        <label for="music-select" class="block text-sm font-medium text-gray-700 mb-1">
                                            Pilih Musik
                                        </label>
                                        <select id="music-select" class="w-full px-3 py-2 border border-[var(--ungu-pastel)] rounded-lg
                                            bg-[var(--ungu-pastel)] text-gray-800 placeholder-gray-500
                                            focus:outline-none focus:ring-2 focus:ring-[var(--ungu)] focus:border-transparent transition duration-300">
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Footer Buttons -->
                    <div class="bg-gray-50 px-6 py-4 sm:flex sm:flex-row-reverse sm:px-6 rounded-b-2xl">
                        <button type="button" id="save-settings-btn"
                            class="inline-flex justify-center rounded-md bg-[var(--oren)] hover:bg-[#d6411f]
                            px-5 py-2 text-sm font-semibold text-white shadow transition duration-300 sm:ml-3 sm:w-auto">
                            Simpan
                        </button>
                        <button type="button" id="cancel-settings-btn"
                            class="mt-3 inline-flex justify-center rounded-md bg-white text-[var(--ungu)] font-semibold
                            px-5 py-2 text-sm shadow ring-1 ring-[var(--ungu)] hover:bg-[var(--ungu-pastel)] transition duration-300 sm:mt-0 sm:w-auto">
                            Batal
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Notes Modal -->
    <div id="notes-modal" role="dialog" aria-modal="true" aria-labelledby="notes-title" class="fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm transition-opacity duration-300 pointer-events-none opacity-0">
        <div aria-hidden="true" class="fixed inset-0 bg-black/60 backdrop-blur-sm transition-opacity opacity-0"></div>

        <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
            <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
                <div class="relative transform overflow-hidden rounded-2xl bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95">
                    <div class="px-6 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <h3 id="notes-title" class="text-lg font-semibold text-[var(--ungu)] mb-4 text-center">
                            Catatan Setelah Selesai Pomodoro
                        </h3>
                        <textarea id="notes-input" rows="4"
                            class="w-full px-4 py-3 border border-[var(--ungu-pastel)] rounded-lg
                            bg-[var(--ungu-pastel)] text-gray-800 placeholder-gray-500 text-sm
                            focus:outline-none focus:ring-2 focus:ring-[var(--ungu)] focus:border-transparent transition duration-300"
                            placeholder="Tulis catatan atau refleksi tentang sesi ini..."></textarea>
                    </div>

                    <div class="bg-gray-50 px-6 py-4 sm:flex sm:flex-row-reverse sm:px-6 rounded-b-2xl">
                        <button type="button" id="save-notes-btn"
                            class="inline-flex justify-center rounded-md bg-[var(--oren)] hover:bg-[#d6411f]
                            px-5 py-2 text-sm font-semibold text-white shadow transition duration-300 sm:ml-3 sm:w-auto">
                            Simpan
                        </button>
                        <button type="button" id="cancel-notes-btn"
                            class="mt-3 inline-flex justify-center rounded-md bg-white text-[var(--ungu)] font-semibold
                            px-5 py-2 text-sm shadow ring-1 ring-[var(--ungu)] hover:bg-[var(--ungu-pastel)] transition duration-300 sm:mt-0 sm:w-auto">
                            Batal
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- <div id="bg-wrapper" class="fixed inset-0 -z-10 overflow-hidden">
        <img id="bg-image" src="./public/assets/images/bg.jpg"
            class="w-full h-full object-cover transition-all duration-500" alt="Background Image">
    </div> -->

    <main>
        <!-- Section Pomodoro Timer -->
        <section class="flex items-center justify-center min-h-screen w-screen bg-gradient-to-b from-[#cfd5fc] to-white transition-colors duration-500 relative py-5">
            <div>
                <!-- Header Panel -->
                <div class="w-full lg:max-w-md mx-auto bg-white/30 backdrop-blur-md rounded-3xl shadow-xl flex justify-between mb-7 p-2 px-4 text-[var(--ungu)] items-center">
                    <h1 class="text-xl font-bold">FocusU</h1>
                    <div class="flex gap-3 justify-center">
                        <button id="settings-btn" class="p-2 w-fit font-semibold rounded-lg bg-white/40 hover:bg-white/50 transition-all">
                            <!-- Icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="-1 -1 18 18">
                                <path d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c-1.4-.413-1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872l-.1-.34zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"/>
                            </svg>
                        </button>
                        <button id="music-btn" class="p-2 w-fit font-semibold rounded-lg bg-white/40 hover:bg-white/50 transition-all">
                            <!-- Music On Icon -->
                            <svg id="music-on-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M9 13c0 1.105-1.12 2-2.5 2S4 14.105 4 13s1.12-2 2.5-2 2.5.895 2.5 2z"/>
                                <path fill-rule="evenodd" d="M9 3v10H8V3h1z"/>
                                <path d="M8 2.5a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-1 0v-9a.5.5 0 0 1 .5-.5z"/>
                            </svg>
                            <!-- Music Off Icon -->
                            <svg id="music-off-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="hidden" viewBox="0 0 16 16">
                                <path d="M9 13c0 1.105-1.12 2-2.5 2S4 14.105 4 13s1.12-2 2.5-2 2.5.895 2.5 2z"/>
                                <path fill-rule="evenodd" d="M9 3v10H8V3h1z"/>
                                <path d="M8 2.5a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-1 0v-9a.5.5 0 0 1 .5-.5z"/>
                                <path d="M 2 2 L 14 14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Konten Timer & To-Do -->
                <div class="xl:flex mt-8">

                    <!-- Timer Card -->
                    <div class="relative w-full lg:max-w-md lg:mx-8 max-xl:mb-5">

                        <!-- Shadow Layer -->
                        <div class="absolute -inset-1 rotate-6 bg-[#ded4f7] rounded-3xl z-0 "></div>
                        <div class="absolute -inset-1 rotate-3 bg-[#c0adeb] rounded-3xl z-0 "></div>

                        <!-- Card Timer Utama -->
                        <div class="relative z-10 bg-[var(--ungu)] text-white rounded-3xl p-6 shadow-xl">
                            <div class="p-6 px-8 sm:p-8 sm:px-10 font-[Poppins]">

                                <!-- Mode Buttons -->
                                <div class="flex justify-center space-x-2 sm:space-x-4 mb-8">
                                    <button id="pomodoro-btn"
                                        class="btn-mode px-4 py-2 min-w-[120px] whitespace-nowrap text-center rounded-full font-semibold transition-all bg-white/20 hover:bg-[var(--ungu-pastel)] hover:text-[var(--ungu)]">
                                        Pomodoro
                                    </button>
                                    <button id="short-break-btn"
                                        class="btn-mode px-4 py-2 min-w-[120px] whitespace-nowrap text-center rounded-full font-semibold transition-all bg-white/20 hover:bg-[var(--ungu-pastel)] hover:text-[var(--ungu)]">
                                        Short Break
                                    </button>
                                    <button id="long-break-btn"
                                        class="btn-mode px-4 py-2 min-w-[120px] whitespace-nowrap text-center rounded-full font-semibold transition-all bg-white/20 hover:bg-[var(--ungu-pastel)] hover:text-[var(--ungu)]">
                                        Long Break
                                    </button>
                                </div>

                                <!-- Animasi -->
                                <div class="flex justify-center mb-4">
                                    <video class="aspect-square w-28 h-28" loop muted playsinline id="gif">
                                        <source src="./public/assets/videos/logoTimerGerak2.webm" type="video/webm" />
                                    </video>
                                </div>

                                <!-- Timer -->
                                <div class="my-6 flex justify-center">
                                    <h1 id="timer-display" class="text-7xl sm:text-8xl md:text-9xl font-black text-white drop-shadow-lg px-6 py-2 rounded-xl">
                                        25:00
                                    </h1>
                                </div>


                                <!-- Tombol Kontrol -->
                                <div class="flex justify-center gap-4">
                                    <button id="start-pause-btn"
                                        class="p-2 font-bold rounded-lg transition-all w-fit bg-white text-[var(--oren)] hover:bg-[var(--oren)] hover:text-white shadow-md">
                                        <!-- Play Icon -->
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                                            class="bi bi-play-fill" viewBox="0 0 16 16">
                                            <path
                                            d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393" />
                                        </svg>
                                    </button>

                                    <button id="reset-btn"
                                        class="p-2 font-bold rounded-lg transition-all w-fit bg-white text-[var(--ungu)] hover:bg-[var(--ungu)] hover:text-white shadow-md">
                                        <!-- Reset Icon -->
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                                            class="bi bi-arrow-counterclockwise" viewBox="0 0 16 16">
                                            <path fill-rule="evenodd"
                                            d="M8 3a5 5 0 1 1-4.546 2.914.5.5 0 0 0-.908-.417A6 6 0 1 0 8 2z" />
                                            <path
                                            d="M8 4.466V.534a.25.25 0 0 0-.41-.192L5.23 2.308a.25.25 0 0 0 0 .384l2.36 1.966A.25.25 0 0 0 8 4.466" />
                                        </svg>
                                    </button>
                                </div>
                                    <!-- Progress Info -->
                                    <div class="text-center mt-6 text-white/80">
                                        <p class="text-sm">Sesi Selesai: <span id="cycle-count">0</span>/<span id="cycles-target">4</span></p>
                                    </div>
                            </div>

                            <footer class="text-center mt-4 text-white/40 text-sm pb-4 font-light">
                                Dibuat oleh FocusU
                            </footer>

                        </div>
                    </div>
                    
                    <!-- To-do List -->
                    <div class="relative lg:max-w-md lg:mx-8 w-full">

                        <!-- Shadow  -->
                        <div class="absolute -inset-1 rotate-6 bg-[#ded4f7] rounded-3xl z-0 "></div>
                        <div class="absolute -inset-1 rotate-3 bg-[#c0adeb] rounded-3xl z-0 "></div>

                        <!-- To-do List Main Card -->
                        <section class="bg-[var(--ungu)] text-white rounded-3xl shadow-xl relative z-10 w-full min-h-[630px]">
                            <div class="p-6 px-8 sm:p-8 sm:px-10">
                                <p class="text-xl font-bold mb-4">Daftar Tugas</p>

                                <form id="todo-form" class="flex gap-2 mb-4">
                                    <input id="todo-input" type="text" placeholder="Tambah tugas..." class="w-full px-4 py-2 border border-gray-300 rounded-lg text-gray-800 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-[var(--oren)] focus:border-transparent" />
                                    <button type="submit" class="px-4 py-2 font-semibold rounded-lg bg-[var(--oren)] text-white hover:bg-[var(--oren)] transition-all">
                                        Tambah
                                    </button>
                                </form>

                                <!-- Tugas akan ditampilkan di sini -->
                                <div class="bg-[var(--ungu-pastel2)] bg-opacity-70 backdrop-blur-sm rounded-2xl p-4 shadow-md text-white min-h-[200px]">

                                    <!-- Daftar Tugas -->
                                    <ul id="todo-list" 
                                    class="space-y-2 block overflow-y-auto max-xl:min-h-[300px] xl:max-h-[70vh] pr-1 text-white ">
                                </ul>

                                    <!-- Optional Placeholder jika kosong -->
                                    <div id="todo-empty-placeholder" class="text-sm text-white/60 text-center py-4 hidden">
                                        Belum ada tugas yang ditambahkan.
                                    </div>
                                    
                                </div>
                              
                            </div>
                        </section>
                    </div>

                </div>

            </div>

        </section>
        


        <!-- Notes Table -->
        <section class="w-full bg-white py-10 px-4 sm:px-8">
            <div class="max-w-5xl mx-auto p-6 px-8 sm:p-8 sm:px-10 bg-[var(--ungu)] text-white rounded-2xl shadow-xl">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-bold flex items-center gap-2">
                        <!-- Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16" width="24" height="24">
                        <path d="M8.5 1.5A1.5 1.5 0 0 1 10 3v1h3.5A1.5 1.5 0 0 1 15 5.5v8A1.5 1.5 0 0 1 13.5 15h-11A1.5 1.5 0 0 1 1 13.5v-11A1.5 1.5 0 0 1 2.5 1H8a.5.5 0 0 1 .5.5zm.5 2.5V3a.5.5 0 0 0-.5-.5H2.5a.5.5 0 0 0-.5.5v10.5a.5.5 0 0 0 .5.5h11a.5.5 0 0 0 .5-.5V5.5A.5.5 0 0 0 13.5 5H9a.5.5 0 0 1-.5-.5z"/>
                        </svg>
                        Catatan Pomodoro
                    </h2>
                    <button id="add-note-btn"
                        class="px-4 py-2 bg-[var(--oren)] text-white font-semibold rounded-lg shadow-md hover:bg-[#d6411f] transition">
                        Tambah Catatan
                    </button>
                </div>

                <div class="overflow-x-auto">
                    <table class="min-w-full rounded-xl overflow-hidden shadow-lg bg-white text-gray-800">
                        <thead class="bg-[var(--ungu-pastel)] text-[var(--ungu)]">
                            <tr>
                                <th class="px-6 py-3 text-left font-semibold">Tanggal & Waktu</th>
                                <th class="px-6 py-3 text-left font-semibold">Catatan</th>
                            </tr>
                        </thead>
                        <tbody id="notes-table-body" class="text-gray-800">
                            <!-- akan diisi otomatis -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>   
    </main>



    <script src="music-list.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const HISTORY_KEY = 'pomodoro_history';
            let pomodoroHistory = JSON.parse(localStorage.getItem(HISTORY_KEY)) || [];

            const notesTableBody = document.getElementById('notes-table-body');
            const addNoteBtn = document.getElementById('add-note-btn');
            const notesModal = document.getElementById('notes-modal');
            const notesBackdrop = notesModal.querySelector('[aria-hidden]');
            const notesPanel = notesModal.querySelector('.transform');
            const notesInput = document.getElementById('notes-input');
            const saveNotesBtn = document.getElementById('save-notes-btn');
            const cancelNotesBtn = document.getElementById('cancel-notes-btn');

            
            function renderNotesTable() {
            notesTableBody.innerHTML = '';
            pomodoroHistory.slice().reverse().forEach(note => {
                const tr = document.createElement('tr');
                tr.className = 'border-b border-gray-200 hover:bg-gray-100 transition-colors';
                tr.innerHTML = `
                    <td class="px-6 py-3 whitespace-nowrap text-gray-800">${new Date(note.timestamp).toLocaleString('id-ID')}</td>
                    <td class="px-6 py-3 text-gray-700">${note.note ? note.note.replace(/</g, "&lt;").replace(/>/g, "&gt;") : '-'}</td>
                `;
                notesTableBody.appendChild(tr);
            });
        }


            addNoteBtn.addEventListener('click', function () {
                notesInput.value = '';
                notesModal.classList.remove('pointer-events-none', 'opacity-0');
                notesBackdrop.classList.remove('opacity-0');
                notesPanel.classList.remove('opacity-0', 'translate-y-4', 'sm:translate-y-0', 'sm:scale-95');
                notesModal.dataset.manual = "true";
            });

            saveNotesBtn.addEventListener('click', function () {
                const note = notesInput.value.trim();
                let mode = 'manual-note';
                if (notesModal.dataset.manual !== "true") {
                    mode = 'pomodoro-cycle-complete';
                }
                pomodoroHistory.push({
                    timestamp: new Date().toISOString(),
                    mode: mode,
                    note: note
                });
                localStorage.setItem(HISTORY_KEY, JSON.stringify(pomodoroHistory));
                renderNotesTable();
                notesModal.classList.add('pointer-events-none', 'opacity-0');
                notesBackdrop.classList.add('opacity-0');
                notesPanel.classList.add('opacity-0', 'translate-y-4', 'sm:translate-y-0', 'sm:scale-95');
                notesModal.dataset.manual = "";
            });

            cancelNotesBtn.addEventListener('click', function () {
                if (notesModal.dataset.manual === "true") {
                    notesModal.classList.add('pointer-events-none', 'opacity-0');
                    notesBackdrop.classList.add('opacity-0');
                    notesPanel.classList.add('opacity-0', 'translate-y-4', 'sm:translate-y-0', 'sm:scale-95');
                    notesModal.dataset.manual = "";
                }
            });


            notesBackdrop.addEventListener('click', function () {
                if (notesModal.dataset.manual === "true") {
                    notesModal.classList.add('pointer-events-none', 'opacity-0');
                    notesBackdrop.classList.add('opacity-0');
                    notesPanel.classList.add('opacity-0', 'translate-y-4', 'sm:translate-y-0', 'sm:scale-95');
                    notesModal.dataset.manual = "";
                }
            });

            renderNotesTable();
            window.renderNotesTable = renderNotesTable;
        });
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {

            const todoForm = document.getElementById('todo-form');
            const todoInput = document.getElementById('todo-input');
            const todoList = document.getElementById('todo-list');
            const STORAGE_KEY = 'pomodoro_todos';
            let todos = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];

            function saveTodos() {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(todos));
            }

            function renderTodos() {
                todoList.innerHTML = '';
                const placeholder = document.getElementById('todo-empty-placeholder');
                if (todos.length === 0) {
                    if (placeholder) placeholder.classList.remove('hidden');
                } else {
                    if (placeholder) placeholder.classList.add('hidden');

                    todos.forEach((todo) => {
                        const li = document.createElement('li');
                        li.className = 'flex items-center justify-between bg-white/10 rounded-lg px-3 py-2';
                        li.innerHTML = `
                            <label class="flex items-center gap-2 cursor-pointer w-full">
                                <input type="checkbox" ${todo.done ? 'checked' : ''} data-id="${todo.id}" class="accent-blue-500">
                                <span class="${todo.done ? 'line-through text-white/50' : ''}">${todo.text}</span>
                            </label>
                            <button data-del="${todo.id}" class="text-white/50 hover:text-red-500 px-2">&times;</button>
                        `;
                        todoList.appendChild(li);
                    });
                }
            }


            todoForm.onsubmit = function (e) {
                e.preventDefault();
                const text = todoInput.value.trim();
                if (text) {
                    todos.unshift({ id: Date.now(), text, done: false });
                    todoInput.value = '';
                    saveTodos();
                    renderTodos();
                }
            };

            todoList.onclick = function (e) {
                if (e.target.matches('input[type="checkbox"]')) {
                    const id = Number(e.target.dataset.id);
                    const todo = todos.find(t => t.id === id);
                    if (todo) {
                        todo.done = e.target.checked;
                        saveTodos();
                        renderTodos();
                    }
                }
                if (e.target.matches('button[data-del]')) {
                    const id = Number(e.target.dataset.del);
                    todos = todos.filter(t => t.id !== id);
                    saveTodos();
                    renderTodos();
                }
            };

            renderTodos();

            // --- Settings ---
            let settings = {
                pomodoroTime: 25,
                shortBreakTime: 5,
                longBreakTime: 15,
                cyclesBeforeLongBreak: 4,
            };

            // DOM ELEMENT
            const timerDisplay = document.getElementById('timer-display');
            const startPauseBtn = document.getElementById('start-pause-btn');
            const resetBtn = document.getElementById('reset-btn');
            const settingsBtn = document.getElementById('settings-btn');
            const musicBtn = document.getElementById('music-btn');
            const musicOnIcon = document.getElementById('music-on-icon');
            const musicOffIcon = document.getElementById('music-off-icon');
            const backgroundMusic = document.getElementById('background-music');
            const pomodoroBtn = document.getElementById('pomodoro-btn');
            const shortBreakBtn = document.getElementById('short-break-btn');
            const longBreakBtn = document.getElementById('long-break-btn');
            const cycleCountDisplay = document.getElementById('cycle-count');
            const cyclesTargetDisplay = document.getElementById('cycles-target');
            const appBody = document.getElementById('app-body');
            const gifVideo = document.getElementById('gif');

            const notesModal = document.getElementById('notes-modal');
            const notesBackdrop = notesModal.querySelector('[aria-hidden]');
            const notesPanel = notesModal.querySelector('.transform');
            const notesInput = document.getElementById('notes-input');
            const saveNotesBtn = document.getElementById('save-notes-btn');
            const cancelNotesBtn = document.getElementById('cancel-notes-btn');


            // Settings modal elements
            const settingsModal = document.getElementById('settings-modal');
            const settingsBackdrop = settingsModal.querySelector('[aria-hidden]');
            const settingsPanel = settingsModal.querySelector('.transform');
            const pomodoroInput = document.getElementById('pomodoro-input');
            const shortBreakInput = document.getElementById('short-break-input');
            const longBreakInput = document.getElementById('long-break-input');
            const cyclesInput = document.getElementById('cycles-input');
            const musicSelect = document.getElementById('music-select');
            const saveSettingsBtn = document.getElementById('save-settings-btn');
            const cancelSettingsBtn = document.getElementById('cancel-settings-btn');

            // --- State Variables ---
            let timerId = null;
            let timeLeft = settings.pomodoroTime * 60;
            let currentMode = 'pomodoro';
            let isPaused = true;
            let cyclesCompleted = 0;


            function playNotificationSound() {
                const sound = document.getElementById('notification-sound');
                sound.currentTime = 0;
                sound.play();

                // Tampilkan konfirmasi setelah 1 detik (biar sound sempat mulai)
                setTimeout(() => {
                    const stop = confirm('Waktu selesai! Klik OK untuk menghentikan alarm.');
                    if (stop) {
                        sound.pause();
                        sound.currentTime = 0;
                    }
                }, 1000);
            }


            // --- Settings Modal Functions ---
            function openSettingsModal() {
                // Load current settings into inputs
                pomodoroInput.value = settings.pomodoroTime;
                shortBreakInput.value = settings.shortBreakTime;
                longBreakInput.value = settings.longBreakTime;
                cyclesInput.value = settings.cyclesBeforeLongBreak;

                settingsModal.classList.remove('pointer-events-none', 'opacity-0');
                settingsBackdrop.classList.remove('opacity-0');
                settingsPanel.classList.remove('opacity-0', 'translate-y-4', 'sm:translate-y-0', 'sm:scale-95');
            }

            function closeSettingsModal() {
                settingsModal.classList.add('pointer-events-none', 'opacity-0');
                settingsBackdrop.classList.add('opacity-0');
                settingsPanel.classList.add('opacity-0', 'translate-y-4', 'sm:translate-y-0', 'sm:scale-95');
            }

            function saveSettings() {
                const newSettings = {
                    pomodoroTime: parseInt(pomodoroInput.value),
                    shortBreakTime: parseInt(shortBreakInput.value),
                    longBreakTime: parseInt(longBreakInput.value),
                    cyclesBeforeLongBreak: parseInt(cyclesInput.value)
                };

                // Validate settings
                if (newSettings.pomodoroTime < 1 || newSettings.pomodoroTime > 60 ||
                    newSettings.shortBreakTime < 1 || newSettings.shortBreakTime > 30 ||
                    newSettings.longBreakTime < 1 || newSettings.longBreakTime > 60 ||
                    newSettings.cyclesBeforeLongBreak < 1 || newSettings.cyclesBeforeLongBreak > 10) {
                    alert('Harap masukkan nilai yang valid!');
                    return;
                }

                settings = newSettings;
                cyclesTargetDisplay.textContent = settings.cyclesBeforeLongBreak;

                // Save settings to localStorage
                localStorage.setItem('pomodoro_settings', JSON.stringify(settings));

                // Reset timer with new settings
                switchMode(currentMode);
                closeSettingsModal();
            }

            // Load settings from localStorage if available
            const savedSettings = localStorage.getItem('pomodoro_settings');
            if (savedSettings) {
                settings = JSON.parse(savedSettings);
            }

            function populateMusicSelect() {
                musicFiles.forEach(file => {
                    const option = document.createElement('option');
                    option.value = `./public/assets/music/${file}`;
                    option.textContent = file.split('.mp3')[0]; // Simplified name
                    musicSelect.appendChild(option);
                });
            }

            function loadMusicSelection() {
                const savedMusic = localStorage.getItem('pomodoro_music');
                if (savedMusic) {
                    backgroundMusic.src = savedMusic;
                    musicSelect.value = savedMusic;
                }
            }

            const HISTORY_KEY = 'pomodoro_history';
            let pomodoroHistory = JSON.parse(localStorage.getItem(HISTORY_KEY)) || [];

            function savePomodoroSession(mode, note = "") {
                pomodoroHistory.push({
                    timestamp: new Date().toISOString(),
                    mode: mode,
                    note: note
                });
                localStorage.setItem(HISTORY_KEY, JSON.stringify(pomodoroHistory));
            }


            // --- Core Functions ---
            function updateTimerDisplay() {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                const formattedTime = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;

                timerDisplay.textContent = formattedTime;
                document.title = `${formattedTime} - ${currentMode.charAt(0).toUpperCase() + currentMode.slice(1)} Timer`;
            }

            function switchMode(mode) {
                currentMode = mode;
                isPaused = true;
                clearInterval(timerId);
                timerId = null;

                switch (mode) {
                    case 'pomodoro':
                        timeLeft = settings.pomodoroTime * 60;
                        break;
                    case 'shortBreak':
                        timeLeft = settings.shortBreakTime * 60;
                        break;
                    case 'longBreak':
                        timeLeft = settings.longBreakTime * 60;
                        break;
                }

                updateUIForMode();
                updateTimerDisplay();
            }

           function updateUIForMode() {
                [pomodoroBtn, shortBreakBtn, longBreakBtn].forEach(btn => {
                    btn.classList.remove('active', 'btn-pomodoro', 'btn-short', 'btn-long');
                });

                gifVideo.pause();
                startPauseBtn.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-play-fill" viewBox="0 0 16 16">
                    <path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393"/>
                    </svg>`;

                let bgColor, activeBtn, activeBtnColor, startBtnColor;

                if (currentMode === 'pomodoro') {
                    gifVideo.setAttribute('src', './public/assets/videos/logoTimerGerak2.webm');
                    bgColor = 'bg-[#fff5f0]';
                    activeBtn = pomodoroBtn;
                    activeBtnColor = 'btn-pomodoro';
                    startBtnColor = 'bg-white text-[var(--oren)]';
                } else if (currentMode === 'shortBreak') {
                    gifVideo.setAttribute('src', './public/assets/videos/logoTimerGerak2.webm');
                    bgColor = 'bg-[#f5f2ff]';
                    activeBtn = shortBreakBtn;
                    activeBtnColor = 'btn-pomodoro';
                    startBtnColor = 'bg-white text-[var(--oren)]';
                } else {
                    gifVideo.setAttribute('src', './public/assets/videos/logoTimerGerak2.webm');
                    bgColor = 'bg-[var(--ungu-pastel)]';
                    activeBtn = longBreakBtn;
                    activeBtnColor = 'btn-pomodoro';
                    startBtnColor = 'bg-white text-[var(--oren)]';
                }

                appBody.className = `flex items-center justify-center min-h-screen transition-colors duration-500 ${bgColor}`;
                activeBtn.classList.add('active', activeBtnColor);
                startPauseBtn.className = `p-2 font-bold rounded-lg transition-all ${startBtnColor}`;

            }


            function handleTimerCompletion() {
                playNotificationSound();

                savePomodoroSession(currentMode);

                if (currentMode === 'pomodoro') {
                    console.log('test');
                    cyclesCompleted++;
                    cycleCountDisplay.textContent = `${cyclesCompleted % settings.cyclesBeforeLongBreak}`;

                    if (cyclesCompleted > 0 && cyclesCompleted % settings.cyclesBeforeLongBreak === 0) {
                        openNotesModal(); // Tampilkan modal catatan
                        return; // Tunggu user isi catatan sebelum lanjut
                    }

                    switchMode('shortBreak');
                } else {
                    switchMode('pomodoro');
                }
            }


            function startTimer() {
                if (timerId !== null) return;

                isPaused = false;
                gifVideo.play();

                startPauseBtn.innerHTML =
                    `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-pause-fill" viewBox="0 0 16 16">
                    <path d="M5.5 3.5A1.5 1.5 0 0 1 7 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5m5 0A1.5 1.5 0 0 1 12 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5"/>
                    </svg>`;

                timerId = setInterval(() => {
                    timeLeft--;
                    updateTimerDisplay();

                    if (timeLeft < 0) {
                        clearInterval(timerId);
                        timerId = null;
                        handleTimerCompletion();
                    }
                }, 1000);
            }

            function pauseTimer() {
                isPaused = true;
                gifVideo.pause();

                startPauseBtn.innerHTML =
                    `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-play-fill" viewBox="0 0 16 16">
                <path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393"/>
            </svg>`;
                clearInterval(timerId);
                timerId = null;
            }

            function resetTimer() {
                switchMode(currentMode);
            }

            // --- Event Listeners ---
            startPauseBtn.addEventListener('click', () => {
                if (isPaused) {
                    startTimer();
                } else {
                    pauseTimer();
                }
            });

            resetBtn.addEventListener('click', resetTimer);
            settingsBtn.addEventListener('click', openSettingsModal);

            musicBtn.addEventListener('click', () => {
                if (backgroundMusic.paused) {
                    backgroundMusic.play();
                    musicOnIcon.classList.remove('hidden');
                    musicOffIcon.classList.add('hidden');
                } else {
                    backgroundMusic.pause();
                    musicOnIcon.classList.add('hidden');
                    musicOffIcon.classList.remove('hidden');
                }
            });

            pomodoroBtn.addEventListener('click', () => switchMode('pomodoro'));
            shortBreakBtn.addEventListener('click', () => switchMode('shortBreak'));
            longBreakBtn.addEventListener('click', () => switchMode('longBreak'));

            // Settings modal event listeners
            saveSettingsBtn.addEventListener('click', saveSettings);
            cancelSettingsBtn.addEventListener('click', closeSettingsModal);
            settingsBackdrop.addEventListener('click', closeSettingsModal);

            musicSelect.addEventListener('change', () => {
                const selectedMusic = musicSelect.value;
                backgroundMusic.src = selectedMusic;
                localStorage.setItem('pomodoro_music', selectedMusic);
            });

            // --- Initial Setup ---
            window.addEventListener('load', () => {
                cyclesTargetDisplay.textContent = settings.cyclesBeforeLongBreak;
                switchMode('pomodoro');
                populateMusicSelect();
                loadMusicSelection();
            });

            function openNotesModal() {
                notesInput.value = '';
                notesModal.classList.remove('pointer-events-none', 'opacity-0');
                notesBackdrop.classList.remove('opacity-0');
                notesPanel.classList.remove('opacity-0', 'translate-y-4', 'sm:translate-y-0', 'sm:scale-95');
            }

            function closeNotesModal() {
                notesModal.classList.add('pointer-events-none', 'opacity-0');
                notesBackdrop.classList.add('opacity-0');
                notesPanel.classList.add('opacity-0', 'translate-y-4', 'sm:translate-y-0', 'sm:scale-95');
            }

            saveNotesBtn.addEventListener('click', () => {
                const note = notesInput.value.trim();
                savePomodoroSession('pomodoro-cycle-complete', note);
                closeNotesModal();
                switchMode('longBreak');
            });

            cancelNotesBtn.addEventListener('click', () => {
                savePomodoroSession('pomodoro-cycle-complete', '');
                closeNotesModal();
                switchMode('longBreak');
            });

            notesBackdrop.addEventListener('click', closeNotesModal);

        });
    </script>

</body>

</html>